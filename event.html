<!DOCTYPE html>
<html> 
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title></title>
        <link rel="shortcut icon" href="http://cloudcamp.org/bundles/cloudcamp/css/images/favicon.ico" />
        <link type="text/css" rel="stylesheet" href="css/cloudcamp.css" />
                
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>-->
        <script type="text/javascript" src="js/underscore-min.js"></script>
        <script type="text/javascript" src="js/utility.js"></script>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript" src="js/campsite.js"></script>
        
        <script id="addJS">

            var id = parseInt(UTIL.getParameterByName('id'));
            if(!_.isNumber(id)) {
                alert("Invalid id");
            }

            COMMUNITY_ID = 21;
            CAMPSITE.process_community('.group-title', "#desc", "#logo-img", true);
            CAMPSITE.process_sponsors('#sponsors-sidebar', id);


            
            var getEvents = function () {
                return UTIL.campsite('events/'+id, { 'fields': 'name,content,starts_at,location,external_url,parent_group.id,parent_group.slug,parent_group.relativeSlug' } );
            };

            var renderEvents = function (events) {
                document.title = events.name;

                if (window.location.protocol != "file:") {
                    window.history.replaceState({}, '', events.parent_group.relativeSlug+'/'+id);
                }

                var starts_at = new Date(events.starts_at);
                var date_str = "(" + UTIL.getDate(starts_at) + ")";
                $("#event-title").html(events.name + " " + date_str );
                $("#content").html( decodeURIComponent(events.content) );
                
                var regBtn = $('#register-button');
                regBtn.attr('target', '_blank');
                if (events.external_url !== null) {
                    regBtn.attr('href', events.external_url);
                } else {
                    regBtn.attr('href', 'http://www.campsite.org/'+events.parent_group.slug+'/event/'+id);
                }
            };

            var dom_dfd = $(document).ready().promise(); // resolved on page load

            getEvents()
            .then(dom_dfd)
            .then(renderEvents);

        </script>
    </head>
    <body>
        <div id="wrap">
            <div class="shell">
                <div id="header">
                    <a href="../index.html"><img id="logo-img"src=""></a>
                </div>
                <div id="nav">
                    <ul class="left">
                        <li class="left"><a href="index.html" class="">Home</a></li>
                        <li class="left"><a href="schedule.html" class="">Schedule</a></li>
                        <li class="left"><a href="event_speakers.html" class="">Speakers</a></li>
                        <li class="left reg"><a href="http://campsite.org/account/register">Register</a></li>
                        <li class="left reg"><a href="http://campsite.org/login">Sign in</a></li>
                    </ul>
                    <ul class="right">&nbsp;</ul>
                    <div class="cl">&nbsp;</div>
                </div>
                <div id="main">
                    <div class="content left">
                        <h1 id='event-title'></h1>
                        <div class="widget-content">
                            <p><a id="register-button" href="#" class="btn">Register for event</a></p>
                        </div>
                        <div>
                            <div id="content"><!-- event details here --></div>
                            <p>&nbsp;</p>
                        </div>
                    </div>
                    <div class="sidebar right">
                        <div class="section">
                            <h5>Sponsors</h5>
                            <ul class="sponsors-sidebar">
                            </ul>
                        </div>
                    </div>
                    <div class="cl"></div>
                        <div id="footer">
                            <div class="foot-nav left">
                                Â© 2012-2014 <span class="group-title"></span>.  All rights reserved.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </body>
</html>
